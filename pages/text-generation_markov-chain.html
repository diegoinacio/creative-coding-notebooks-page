<!DOCTYPE html><html><head><!-- ! google analytics --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JSBTM5PWQ3"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-JSBTM5PWQ3');</script><!-- /! google analytics --><!-- ! custom meta tags --><link rel="icon" type="image/svg+xml" href="../favicon.svg"><link rel="alternate icon" href="../favicon.ico"><title>Text Generation | M.L. + A.I.</title><meta name="section_name" content="M.L. + A.I."><meta name="section_id" content="ML-and-AI"><meta name="notebook_name" content="Text Generation"><meta name="notebook_id" content="text-generation_markov-chain"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Diego Inácio"><meta property="og:url" content="https://diegoinacio.github.io/creative-coding-notebooks-page/pages/text-generation_markov-chain.html"><meta name="title" property="og:title" content="Text Generation >> Creative Coding Notebooks | Diego Inácio"><meta name="description" property="og:description" content="Text generation with <em>Markov Chain</em>, using characters as base."><meta name="image" property="og:image" content="https://diegoinacio.github.io/creative-coding-notebooks-page/images/thumb_text-generation_markov-chain.jpg"><meta property="og:image:type" content="image/jpeg"><meta property="og:type" content="article"><meta property="article:author" content="Diego Inácio"><meta property="article:section" content="Creative Coding Notebooks"><!-- /! custom meta tags --><!-- ! custom notebook style --><link rel="stylesheet" href="../assets/css/notebook-standard.css"><link rel="stylesheet" href="../assets/css/notebook-custom.css"><!-- /! custom notebook style --><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script><!-- Load mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"></script><!-- MathJax configuration --><script type="text/x-mathjax-config">init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: { 
                    automatic: true 
                    }
                },
                "HTML-CSS": {
                    linebreaks: { 
                    automatic: true 
                    }
                }
            });
        
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();</script><!-- End of mathjax configuration --><!-- ! custom Ko-fi importer --><script type="text/javascript" src="https://storage.ko-fi.com/cdn/widget/Widget_2.js"></script><!-- /! custom Ko-fi importer --></head><body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light"><!-- ! custom navbar --><div class="notebook-navbar"></div><!-- /! custom navbar --><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h1 id="Text-Generation-[Markov-Chain]">Text Generation [Markov Chain]<a class="anchor-link" href="#Text-Generation-[Markov-Chain]">¶</a></h1><hr><ul><li>Author: Diego Inácio</li><li>GitHub: <a href="https://github.com/diegoinacio">github.com/diegoinacio</a></li><li>Notebook: <a href="https://github.com/diegoinacio/creative-coding-notebooks/blob/master/ML-and-AI/text-generation_markov-chain.ipynb">text-generation_markov-chain.ipynb</a></li></ul><hr><p>Text generation with <a href="https://en.wikipedia.org/wiki/Markov_chain"><em>Markov Chain</em></a>, using characters as base.</p><p>A <em>Markov chain</em> is a sequence $x_1, x_2, x_3, ..., x_n$ of random variables - in our case, random characters. The distribution of the conditional probabilities of $x_{n+1}$ is a function of $x_n$, where:</p>$$ \large \displaystyle \Pr(X_{n+1}=x|X_{0},X_{1},X_{2},\ldots ,X_{n})=\Pr(X_{n+1}=x|X_{n}) $$</div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[1]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Scraping libraries</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div></div></div></div></div></div><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h2 id="Data-Scraping">Data Scraping<a class="anchor-link" href="#Data-Scraping">¶</a></h2><hr><p>As data, we are going to use lyrics from one of my favorite hard rock band.. <strong>Van Halen</strong>. To get those lyrics, let's scrape this data in the website <a href="https://www.allthelyrics.com">AllTheLyrics</a> and process them to build a text corpus.</p></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[2]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Request and parse</span>
<span class="n">PAGE</span> <span class="o">=</span> <span class="s2">"https://www.allthelyrics.com"</span>
<span class="n">URL</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">PAGE</span><span class="si">}</span><span class="s1">/lyrics/van_halen'</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="n">parse</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">"html.parser"</span><span class="p">)</span>
</pre></div></div></div></div></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[3]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Define how many lyrics will be considered</span>
<span class="c1"># p = 0.1 indicates that 10% will be read</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.2</span>        <span class="c1"># ! Parameter</span>

<span class="c1"># Init text corpus</span>
<span class="n">TEXT</span> <span class="o">=</span> <span class="s2">""</span>

<span class="c1"># Find all </span>
<span class="n">ITEM</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"li"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"lyrics-list-item"</span><span class="p">})</span>
<span class="n">ITEM_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">ITEM</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ITEM</span><span class="p">):</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ITEM_alpha</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="k">continue</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">PAGE</span><span class="si">}{</span><span class="n">link</span><span class="p">[</span><span class="s2">"href"</span><span class="p">]</span><span class="si">}</span><span class="s1">'</span>
    <span class="n">request_</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">parse_</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">request_</span><span class="p">,</span> <span class="s2">"html.parser"</span><span class="p">)</span>
    <span class="n">TEXT</span> <span class="o">+=</span> <span class="n">parse_</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"div"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"content-text-inner"</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">ITEM</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;06.02f</span><span class="si">}</span><span class="s1"> %'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\r</span><span class="s2">"</span><span class="p">)</span>
<span class="n">TEXT</span> <span class="o">=</span> <span class="n">TEXT</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="mi">100</span><span class="si">:</span><span class="s1">&gt;06.02f</span><span class="si">}</span><span class="s1"> %'</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="jp-Cell-outputWrapper"><div class="jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-child"><div class="jp-OutputPrompt jp-OutputArea-prompt"></div><div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain"><pre>100.00 %
Wall time: 23.4 s
</pre></div></div></div></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[4]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Find all characters and symbols in the text</span>
<span class="n">SYMBOLS</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">TEXT</span><span class="p">))</span>
<span class="n">SYMBOLS_N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">SYMBOLS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SYMBOLS</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="jp-Cell-outputWrapper"><div class="jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-child"><div class="jp-OutputPrompt jp-OutputArea-prompt"></div><div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain"><pre>[' ', '!', "'", '(', ')', ',', '-', '.', '0', '1', '3', '5', '9', '?', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'R', 'S', 'T', 'U', 'W', 'Y', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'º']
</pre></div></div></div></div></div><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h2 id="Transition-Matrix">Transition Matrix<a class="anchor-link" href="#Transition-Matrix">¶</a></h2><hr><p><a href="https://en.wikipedia.org/wiki/Markov_chain#Transitions">Transition</a> matrix contains all probilities for the next event, considering the current one. For example, considering the possibilities <strong>A</strong>, <strong>B</strong> and <strong>C</strong>:</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">A</th><th style="text-align:center">B</th><th style="text-align:center">C</th></tr></thead><tbody><tr><td style="text-align:center">A</td><td style="text-align:center">0.1</td><td style="text-align:center">0.6</td><td style="text-align:center">0.3</td></tr><tr><td style="text-align:center">B</td><td style="text-align:center">0.25</td><td style="text-align:center">0.05</td><td style="text-align:center">0.7</td></tr><tr><td style="text-align:center">C</td><td style="text-align:center">0.7</td><td style="text-align:center">0.3</td><td style="text-align:center">0</td></tr></tbody></table><p>If the current state is <strong>A</strong>, the probability of getting <strong>B</strong> is <em>0.6</em>.</p><p>In this case, the transition matrix has order 1. For nth-order matrices, we consider the last <strong>n</strong> states in sequence. For example, a 2nd-order matrix would be:</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">A</th><th style="text-align:center">B</th><th style="text-align:center">C</th></tr></thead><tbody><tr><td style="text-align:center">AA</td><td style="text-align:center">0.1</td><td style="text-align:center">0.6</td><td style="text-align:center">0.3</td></tr><tr><td style="text-align:center">AB</td><td style="text-align:center">0.25</td><td style="text-align:center">0.05</td><td style="text-align:center">0.7</td></tr><tr><td style="text-align:center">:</td><td style="text-align:center">...</td><td style="text-align:center">...</td><td style="text-align:center">...</td></tr><tr><td style="text-align:center">CA</td><td style="text-align:center">0.7</td><td style="text-align:center">0.3</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">:</td><td style="text-align:center">...</td><td style="text-align:center">...</td><td style="text-align:center">...</td></tr></tbody></table><p>The higher the order, the more "readable" the generated text will be.</p><p>To build our transion matrix we have basically to calculate the probability of the states, depending on the order we want to use.</p></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[5]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">order_sequences</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Return all character sequences with length equal to the order</span>
<span class="sd">    """</span>
    <span class="n">TEXT_N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXT</span><span class="p">)</span>
    <span class="n">ORDERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">TEXT</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">order</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TEXT_N</span> <span class="o">-</span> <span class="n">order</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ORDERS</span><span class="p">))</span>
</pre></div></div></div></div></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[6]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">transition_matrix</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="n">ORDERS</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Build transition matrix</span>
<span class="sd">    """</span>
    <span class="n">ORDERS_N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ORDERS</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">ORDERS_N</span><span class="p">,</span> <span class="n">SYMBOLS_N</span><span class="p">])</span><span class="o">*</span><span class="mf">1e-8</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TEXT</span><span class="p">[</span><span class="n">order</span><span class="p">:],</span> <span class="n">order</span><span class="p">):</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">SYMBOLS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">TEXT</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">order</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="n">ORDERS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
        <span class="n">P</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">i1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">/</span><span class="n">P</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">P</span>
</pre></div></div></div></div></div></div><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h2 id="Text-Generation">Text Generation<a class="anchor-link" href="#Text-Generation">¶</a></h2><hr><p>Having the transition matrix, we can start building the text generation procedure. The first step is to define the inital state and ganerate the following states by using the probabilities and choosing randomly.</p></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[7]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">text_generation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Generate text</span>
<span class="sd">    """</span>
    <span class="c1"># Get transition matrix</span>
    <span class="n">ORDERS</span> <span class="o">=</span> <span class="n">order_sequences</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">transition_matrix</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="n">ORDERS</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="c1"># Count the occurences in the text, for each sequence</span>
    <span class="c1"># and define its probabilities</span>
    <span class="n">ORDERS_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">TEXT</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ORDERS</span><span class="p">])</span>
    <span class="n">ORDERS_p</span> <span class="o">=</span> <span class="n">ORDERS_count</span><span class="o">/</span><span class="n">ORDERS_count</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="c1"># Build text</span>
    <span class="n">LINE</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="c1"># Define initial chain of characters randomly</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ORDERS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">ORDERS_p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">line_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">line_s</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">","</span><span class="p">,</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"!"</span><span class="p">]):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">index0</span> <span class="o">=</span> <span class="n">ORDERS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="n">order</span><span class="p">:])</span>
            <span class="n">p</span> <span class="o">*=</span> <span class="n">P</span><span class="p">[</span><span class="n">index0</span><span class="p">]</span>
            <span class="n">index1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">SYMBOLS_N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sum</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">SYMBOLS</span><span class="p">[</span><span class="n">index1</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">symbol</span>
        <span class="n">LINE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LINE</span><span class="p">)</span>
</pre></div></div></div></div></div></div><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h2 id="Examples">Examples<a class="anchor-link" href="#Examples">¶</a></h2><hr><p>In order to visualize the impact of the order in the transition matrix, let's generate texts with multiple nth-order matrices.</p></div></div><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h3 id="1st-order-Matrix">1st-order Matrix<a class="anchor-link" href="#1st-order-Matrix">¶</a></h3><hr><p>In this case, we just consider the current character probabilities, which is likely to produce a weird text.</p></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[8]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text_generation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text_generation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div></div></div></div></div><div class="jp-Cell-outputWrapper"><div class="jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-child"><div class="jp-OutputPrompt jp-OutputArea-prompt"></div><div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain"><pre>et y gelwn'scanseayour lous Heemag,
 t swilo) wal 10 be m me he, llivet St. wassthin'tayot 
veveroniee rere th is ike Gofa.
horer chth t t, sh! Pa. sh Ith, s myolinof I'shaye'stha 
d I f Totot sep paront (rad it's 
d k wn am t'vestsedomee mat wh, n het y'verehangouronghanallive 
e Bure choh Do Ifisol co oheterodan're 
 buin' lieede s lo drorowno) rer 

p d oune ived,iguppathet 
our iny bere k t Anongheve reve I Nouronooun I 
 maywatyel yowh sot ckndicitheromyelitroun'veas 
unt st lerende (d lsainttow,
 f t y h, in' St mu if sis 
 fu youngh fend, (ray 
bakn ) t'mowevere t 
buplilirdr s sat'.. st ag g Oou betin'tawhe 
</pre></div></div></div></div></div><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h3 id="3rd-order-Matrix">3rd-order Matrix<a class="anchor-link" href="#3rd-order-Matrix">¶</a></h3><hr><p>In this case, we consider the last 3 characters probabilities, which is likely to produce a more comprehensive words.</p></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[9]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text_generation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text_generation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div></div></div></div></div><div class="jp-Cell-outputWrapper"><div class="jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-child"><div class="jp-OutputPrompt jp-OutputArea-prompt"></div><div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain"><pre>e... what you know mine, lovin' 
led, round, round, near all 
 stillin', I'd, round, round, 
ound, For divide it ride your belin' Go some down 
ring in me world Give You Oucheeliever Uh,
, Are mone body sharely Only to how who 
 ooo) what you wake it wer be the 
 be subtle with someone can puts 

ed a wheek a 3 piece ream,
 give else what want life You'll me everywhen the 
pail Sweet it hey you want 
ook in ove and neve it nothing you know show magic,
 must turn you Dig deny 
on! Dream, get she's comind want little We're 
ed upon the comind the a stop lost of want faithough 
m feeliever a litter (Ooooh oooh 
</pre></div></div></div></div></div><div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt"></div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown"><h3 id="7th-order-Matrix">7th-order Matrix<a class="anchor-link" href="#7th-order-Matrix">¶</a></h3><hr><p>In this case, we consider the last 7 characters probabilities, which is likely to produce a little more comprehensive sentences.</p></div></div><div class="jp-Cell jp-CodeCell jp-Notebook-cell"><div class="jp-Cell-inputWrapper"><div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[10]:</div><div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline"><div class="CodeMirror cm-s-jupyter"><div class="highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text_generation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text_generation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div></div></div></div></div><div class="jp-Cell-outputWrapper"><div class="jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-child"><div class="jp-OutputPrompt jp-OutputArea-prompt"></div><div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain"><pre>e. Standing on top of the women 
see baby now! Hey, you don't always been 
o live Give to live Give 
n'....no, don't know, Cause it's gonna stop 
 Love hurts you sometimes 
ed up in lights Everything you've got to give You've 
st once born, can't ever lose faith 
 I wonder who I'd rather be if I had one wish 

o try, oh could it ever 
ce can't refuse I wouldn't know and 
st believe a little If you want faith, you just 
or is a little while your head,
round) Run-run-runaround, round) 
ever had no room to second guess puts me under 
thing's gonna like it Hey! Alright! Whoo! How 'bout 
ed Oh, what a fool believe You can always make 
</pre></div></div></div></div></div><!-- ! custom footer --><footer class="notebook-footer"></footer><!-- /! custom footer --><!-- ! custom scripts --><script src="../assets/template/notebook.js"></script><!-- /! custom scripts --></body></html>